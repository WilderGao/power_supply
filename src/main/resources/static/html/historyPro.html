<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>南方电网订购材料网站</title>
	<link rel="stylesheet" type="text/css" href="../bootstrap/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="../css/nav.css">
	<script type="text/javascript" src="../js/jquery-3.2.1.js"></script>
	<script type="text/javascript" src="../js/url.js"></script>
	<script type="text/javascript" src="../bootstrap/js/bootstrap.js"></script>
	<style type="text/css">
		div.nav{border-bottom: 1px solid gray;}
		div.nav_box{width: 1000px;margin: 10px auto;}
		.history_box{width: 1200px;margin: 10px auto;}
		.stuff_box{overflow: hidden;}
		.stuff_box div{float: left;}
		div.projectName{width: 500px;}
		div.projectCode{width: 180px;}
		div.powerSupply{width: 100px;}
		div.district{width: 100px;}
		div.batch{width: 80px;text-align: center;}
		div.see{width: 120px;float:right;}
	</style>
</head>
<body>
<!-- 导航条 -->
<div class="nav">
	<div class="nav_box">
        <h3>
        	<a role="button" class="nav-a" href="home.html">首页</a>
        	<a role="button" class="nav-a" href="device.html">查看设备</a>
        	<a role="button" class="nav-a" href="historyPro.html">查看历史工程</a>
        </h3>
    </div>
</div>
<div class="history_box">
	<ul class="list-group stuff_ul">
	    <li class="list-group-item active">
	    	<div class="stuff_box">
	    		<div class="projectName">工程名称</div>
	    		<div class="projectCode">工程编号</div>
	    		<div class="powerSupply">供电所</div>
				<div class="district">区局</div>
				<div class="batch">批次</div>
				<div class="see"><button type="button" class="btn btn-default" id="see_detail">查看工程详情</button></div>
	    	</div>
	    </li>
	    <li class="list-group-item">
	    	<div class="stuff_box">
	    		<div class="projectName">工程名称</div>
	    		<div class="projectCode">工程编号</div>
	    		<div class="powerSupply">供电所</div>
				<div class="district">区局</div>
				<div class="batch">批次</div>
				<div class="see"><button type="button" class="btn btn-default" id="see_detail">查看工程详情</button></div>
	    	</div>
	    </li>
	</ul>
</div>
<script type="text/javascript">
function fillMainData(stuff){
    	var ul = $(".stuff_ul");
    	var len = stuff.length;
    	var i = 0;
    	var html = '<li class="list-group-item active"><div class="stuff_box"><div class="projectName">工程名称</div><div class="projectCode">工程编号</div><div class="powerSupply">供电所</div><div class="district">区局</div><div class="batch">批次</div></div></li>';
    	for(;i<len;i++){
    		html += '<li class="list-group-item"><div class="stuff_box"><div class="projectName">';
    		html += stuff[i].projectName + '</div><div class="projectCode">';
    		html += stuff[i].projectCode + '</div><div class="powerSupply">';
    		html += stuff[i].powerSupply + '</div><div class="district">';
    		html += stuff[i].district + '</div><div class="batch">';
    		html += stuff[i].batch + '</div><div class="see"><input class="btn btn-primary" type="button" value="查看工程详情" data-id="';
    		html += stuff[i].projectId+ '"></div></div></li>';
    	}
    	ul.html(html);
    }
    var allResult = $.getAllPro(1,null);
	var result;	
	if(allResult.status!="404"){
		result = allResult.info;
		fillMainData(result);
	}else{
		fillMainData([]);
		alert("网络不佳，请刷新页面");
	}
	var mainBox = $(".history_box");
	mainBox.click(function(ev){
		var target = $(ev.target);
		if(ev.target.nodeName.toLowerCase() == "input"){
			dataId = parseInt(target.attr("data-id"));
			console.log(dataId);
			url = $.UrlUpdateParams("detailPro.html","id",dataId);
			console.log(url)
			window.location.href = url;
		}
	});
</script>
</body>
</html>